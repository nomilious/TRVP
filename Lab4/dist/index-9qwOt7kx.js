var I=Object.defineProperty;var D=(o,t,e)=>t in o?I(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var d=(o,t,e)=>(D(o,typeof t!="symbol"?t+"":t,e),e),E=(o,t,e)=>{if(!t.has(o))throw TypeError("Cannot "+e)};var r=(o,t,e)=>(E(o,t,"read from private field"),e?e.call(o):t.get(o)),p=(o,t,e)=>{if(t.has(o))throw TypeError("Cannot add the same private member more than once");t instanceof WeakSet?t.add(o):t.set(o,e)},h=(o,t,e,n)=>(E(o,t,"write to private field"),n?n.call(o,e):t.set(o,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function e(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(s){if(s.ep)return;s.ep=!0;const a=e(s);fetch(s.href,a)}})();var k,f,y;class L{constructor({text:t,order:e,onEditTask:n,onDeleteTask:s}){p(this,k,"");p(this,f,"");p(this,y,-1);h(this,k,crypto.randomUUID()),h(this,f,t),h(this,y,e),this.onEditTask=n,this.onDeleteTask=s}get taskID(){return r(this,k)}get taskText(){return r(this,f)}set taskText(t){typeof t=="string"&&h(this,f,t)}get taskOrder(){return r(this,y)}set taskOrder(t){typeof t=="number"&&t>=0&&h(this,y,t)}render(){const t=document.createElement("li");t.classList.add("tasklist__tasks-list-item","task"),t.setAttribute("id",r(this,k)),t.setAttribute("draggable",!0),t.addEventListener("dragstart",m=>{m.target.classList.add("task_selected"),localStorage.setItem("movedTaskID",r(this,k))}),t.addEventListener("dragend",m=>m.target.classList.remove("task_selected"));const e=document.createElement("span");e.classList.add("task__text"),e.innerHTML=r(this,f),t.appendChild(e);const n=document.createElement("div");n.classList.add("task__controls");const s=document.createElement("div");s.classList.add("task__controls-row");const a=document.createElement("button");a.setAttribute("type","button"),a.classList.add("task__contol-btn","edit-icon"),a.addEventListener("click",()=>this.onEditTask({taskID:r(this,k)})),s.appendChild(a);const i=document.createElement("button");return i.setAttribute("type","button"),i.classList.add("task__contol-btn","delete-icon"),i.addEventListener("click",()=>this.onDeleteTask({taskID:r(this,k)})),s.appendChild(i),n.appendChild(s),t.appendChild(n),t}}k=new WeakMap,f=new WeakMap,y=new WeakMap;var l,g,u;class b{constructor({name:t,onDropTaskInTasklist:e,onEditTask:n,onDeleteTask:s}){p(this,l,[]);p(this,g,"");p(this,u,"");d(this,"addTask",({task:t})=>r(this,l).push(t));d(this,"getTaskById",({taskID:t})=>r(this,l).find(e=>e.taskID===t));d(this,"deleteTask",({taskID:t})=>{const e=r(this,l).findIndex(s=>s.taskID===t);if(e===-1)return;const[n]=r(this,l).splice(e,1);return n});d(this,"reorderTasks",()=>{Array.from(document.querySelector(`[id="${r(this,u)}"] .tasklist__tasks-list`).children,e=>e.getAttribute("id")).forEach((e,n)=>{r(this,l).find(s=>s.taskID===e).taskOrder=n})});d(this,"onAddNewTask",()=>{const t=prompt("Введите описание задачи:","Новая задача");if(!t)return;const e=new L({text:t,order:r(this,l).length,onEditTask:this.onEditTask,onDeleteTask:this.onDeleteTask});r(this,l).push(e);const n=e.render();document.querySelector(`[id="${r(this,u)}"] .tasklist__tasks-list`).appendChild(n)});h(this,g,t),h(this,u,crypto.randomUUID()),this.onDropTaskInTasklist=e,this.onEditTask=n,this.onDeleteTask=s}get tasklistID(){return r(this,u)}render(){const t=document.createElement("li");t.classList.add("tasklists-list__item","tasklist"),t.setAttribute("id",r(this,u)),t.addEventListener("dragstart",()=>localStorage.setItem("srcTasklistID",r(this,u))),t.addEventListener("drop",this.onDropTaskInTasklist);const e=document.createElement("h2");e.classList.add("tasklist__name"),e.innerHTML=r(this,g),t.appendChild(e);const n=document.createElement("ul");n.classList.add("tasklist__tasks-list"),t.appendChild(n);const s=document.createElement("button");s.setAttribute("type","button"),s.classList.add("tasklist__add-task-btn"),s.innerHTML="&#10010; Добавить карточку",s.addEventListener("click",this.onAddNewTask),t.appendChild(s);const a=document.querySelector(".tasklist-adder");a.parentElement.insertBefore(t,a)}}l=new WeakMap,g=new WeakMap,u=new WeakMap;var T;class S{constructor(){p(this,T,[]);d(this,"onEscapeKeydown",t=>{if(t.key==="Escape"){const e=document.querySelector(".tasklist-adder__input");e.style.display="none",e.value="",document.querySelector(".tasklist-adder__btn").style.display="inherit"}});d(this,"onInputKeydown",t=>{if(t.key==="Enter"){if(t.target.value){const e=new b({name:t.target.value,onDropTaskInTasklist:this.onDropTaskInTasklist,onEditTask:this.onEditTask,onDeleteTask:this.onDeleteTask});r(this,T).push(e),e.render()}t.target.style.display="none",t.target.value="",document.querySelector(".tasklist-adder__btn").style.display="inherit"}});d(this,"onDropTaskInTasklist",t=>{t.stopPropagation();const e=t.currentTarget;e.classList.remove("tasklist_droppable");const n=localStorage.getItem("movedTaskID"),s=localStorage.getItem("srcTasklistID"),a=e.getAttribute("id");if(localStorage.setItem("movedTaskID",""),localStorage.setItem("srcTasklistID",""),!e.querySelector(`[id="${n}"]`))return;const i=r(this,T).find(c=>c.tasklistID===s),m=r(this,T).find(c=>c.tasklistID===a);if(s!==a){const c=i.deleteTask({taskID:n});m.addTask({task:c}),i.reorderTasks()}Array.from(e.querySelector(".tasklist__tasks-list").children,c=>c.getAttribute("id")).forEach((c,_)=>{m.getTaskById({taskID:c}).taskOrder=_})});d(this,"onEditTask",({taskID:t})=>{let e=null;for(let a of r(this,T))if(e=a.getTaskById({taskID:t}),e)break;const n=e.taskText,s=prompt("Введите новое описание задачи");!s||s===n||(e.taskText=s,document.querySelector(`[id="${t}"] span.task__text`).innerHTML=s)});d(this,"onDeleteTask",({taskID:t})=>{let e=null,n=null;for(let a of r(this,T))if(n=a,e=a.getTaskById({taskID:t}),e)break;confirm(`Задача '${e.taskText}' будет удалена. Прододлжить?`)&&(n.deleteTask({taskID:t}),document.getElementById(t).remove())})}init(){document.querySelector(".tasklist-adder__btn").addEventListener("click",t=>{t.target.style.display="none";const e=document.querySelector(".tasklist-adder__input");e.style.display="inherit",e.focus()}),document.addEventListener("keydown",this.onEscapeKeydown),document.querySelector(".tasklist-adder__input").addEventListener("keydown",this.onInputKeydown),document.getElementById("theme-switch").addEventListener("change",t=>{t.target.checked?document.body.classList.add("dark-theme"):document.body.classList.remove("dark-theme")}),document.addEventListener("dragover",t=>{t.preventDefault();const e=document.querySelector(".task.task_selected"),n=e.closest(".tasklist"),s=t.target,a=document.querySelector(".tasklist_droppable");let i=t.target;for(;!i.matches(".tasklist")&&i!==document.body;)i=i.parentElement;if(i!==a&&(a&&a.classList.remove("tasklist_droppable"),i.matches(".tasklist")&&i.classList.add("tasklist_droppable")),!(!i.matches(".tasklist")||e===s)){if(i===n){if(!s.matches(".task"))return;const m=s===e.nextElementSibling?s.nextElementSibling:s;i.querySelector(".tasklist__tasks-list").insertBefore(e,m);return}if(s.matches(".task")){i.querySelector(".tasklist__tasks-list").insertBefore(e,s);return}i.querySelector(".tasklist__tasks-list").children.length||i.querySelector(".tasklist__tasks-list").appendChild(e)}})}}T=new WeakMap;document.addEventListener("DOMContentLoaded",()=>{console.log("OK"),new S().init()});
